<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="marked-import.html"></head><body><dom-module id="marked-element"><template><style>:host{display:block;}.hidden{display:none !important;}</style><content select=".markdown-html"></content><div id="content" class="hidden"></div></template></dom-module><script>'use strict';Polymer({is:'marked-element',properties:{markdown:{observer:'render',type:String,value:null},breaks:{observer:'render',type:Boolean,value:!1},pedantic:{observer:'render',type:Boolean,value:!1},renderer:{observer:'render',type:Function,value:null},sanitize:{observer:'render',type:Boolean,value:!1},smartypants:{observer:'render',type:Boolean,value:!1},callback:{observer:'render',type:Function,value:null},xhr:{type:Object,notify:!0,readOnly:!0}},ready:function(){if(!this.markdown&&(this._markdownElement=Polymer.dom(this).querySelector('[type="text/markdown"]'),!!this._markdownElement))if(this.markdown=this._unindent(this._markdownElement.textContent),this._markdownElement.src)this._request(this._markdownElement.src);else{var a=new MutationObserver(this._onScriptAttributeChanged.bind(this));a.observe(this._markdownElement,{attributes:!0})}},attached:function(){this._attached=!0,this._outputElement=this.outputElement,this.render()},detached:function(){this._attached=!1},unindent:function(a){return this._unindent(a)},get outputElement(){var a=Polymer.dom(this).queryDistributedElements('.markdown-html')[0];return a?a:(this.toggleClass('hidden',!1,this.$.content),this.$.content)},render:function(){if(this._attached){if(!this.markdown)return void(Polymer.dom(this._outputElement).innerHTML='');var a=new marked.Renderer;this.renderer&&this.renderer(a);var b={renderer:a,highlight:this._highlight.bind(this),breaks:this.breaks,sanitize:this.sanitize,pedantic:this.pedantic,smartypants:this.smartypants};Polymer.dom(this._outputElement).innerHTML=marked(this.markdown,b,this.callback),this.fire('marked-render-complete')}},_highlight:function(a,b){var c=this.fire('syntax-highlight',{code:a,lang:b});return c.detail.code||a},_unindent:function(a){if(!a)return a;var b=a.replace(/\t/g,'  ').split('\n'),c=b.reduce(function(d,f){if(/^\s*$/.test(f))return d;var g=f.match(/^(\s*)/)[0].length;return null===d?g:g<d?g:d},null);return b.map(function(d){return d.substr(c)}).join('\n')},_request:function(a){this._setXhr(new XMLHttpRequest);var b=this.xhr;return 0<b.readyState?null:void(b.addEventListener('error',this._handleError.bind(this)),b.addEventListener('loadend',function(c){var d=this.xhr.status||0;0===d||200<=d&&300>d?(this.sanitize=!0,this.markdown=c.target.response):this._handleError(c),this.fire('marked-loadend',c)}.bind(this)),b.open('GET',a),b.setRequestHeader('Accept','text/markdown'),b.send())},_handleError:function(a){var b=this.fire('marked-request-error',a,{cancelable:!0});b.defaultPrevented||(this.markdown='Failed loading markdown source')},_onScriptAttributeChanged:function(a){'src'!==a[0].attributeName||this._request(this._markdownElement.src)}});</script></body></html>