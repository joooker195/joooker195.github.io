<html><head><link rel="import" href="../bower_components/polymer/polymer.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/iron-pages/iron-pages.html"><link rel="import" href="../bower_components/iron-list/iron-list.html"><link rel="import" href="../bower_components/iron-selector/iron-selector.html"><link rel="import" href="../bower_components/paper-listbox/paper-listbox.html"><link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html"><link rel="import" href="../bower_components/paper-item/paper-item.html"><link rel="import" href="../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../bower_components/iron-label/iron-label.html"><link rel="import" href="../bower_components/paper-card/paper-card.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/paper-styles/color.html"><link rel="import" href="../bower_components/paper-styles/typography.html"><link rel="import" href="../bower_components/iron-elements/iron-elements.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="my-view3"><template><style>:host{display:block;line-height:8px;padding:10px;}body{display:flex;align-items:center;justify-content:center;}paper-card{max-width:500px;margin-bottom:-190px;display:block;background:white;padding:10px;border-radius:20px;line-height:8px;}.cafe-header{@apply (--paper-font-headline);}.cafe-reserve{color:var(--google-blue-500);}.card{margin:24px;padding:16px;color:#757575;border-radius:5px;background-color:#fff;box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);}</style><div class="card"><paper-input label="Имя категории" value="{{latestCategoryName}}"></paper-input><br><paper-button raised="" noink="" id="addCategoryBtn" on-click="addRecord">Добавить категорию</paper-button><paper-button raised="" noink="" id="updateCategoryBtn" on-click="updateRecords">Обновить</paper-button></div><div class="card"><template is="dom-repeat" items="{{listItems}}"><paper-listbox><paper-item><div><span>{{item.categoryName }}</span><paper-button raised="" noink="" id="editCategoryBtn" on-click="editRecord">Изменить</paper-button><paper-button raised="" noink="" id="delCategoryBtn" on-click="deleteRecord">Удалить</paper-button></div></paper-item></paper-listbox></template></div></template><script>Polymer({is:'my-view3',properties:{prop1:{type:String,value:'my-view3'},listItems:{type:Array,value:[]}},ready:function(){this.listItems=[],this.latestCategoryName=''},addRecord:function(){if(''!=this.latestCategoryName){var c=openCategory.result,d=c.transaction('MyObjectStore','readwrite'),f=d.objectStore('MyObjectStore');++ind,console.log('ind: '+ind),f.put({id:ind,categoryName:this.latestCategoryName,isComplete:!1}),help.push({id:ind,categoryName:this.latestCategoryName,isComplete:!1}),this.latestCategoryName='',this.updateRecords()}},editRecord:function(c){if(''!=this.latestCategoryName){var d=c.model.item.categoryName,f=this.latestCategoryName;console.log('category name: '+d);var g=help.findIndex(function(n){return n.categoryName===d}),h=openCategory.result,j=h.transaction('MyObjectStore','readwrite'),k=j.objectStore('MyObjectStore'),l=k.index('categoryName'),m=l.get(d);m.onsuccess=function(){console.log('---------------------------------------'),console.log('edit: \''+f+'\' to \''+d+'\'');var p=m.result;p.categoryName=f;var q=k.put(p);q.onsuccess=function(){console.log('edit')}},help[g].categoryName=f,this.updateRecords()}console.log('edit')},deleteRecord:function(c){var d=c.model.item.categoryName;console.log(this.listItems);var f=openCategory.result,g=f.transaction('MyObjectStore','readwrite'),h=g.objectStore('MyObjectStore'),j=h.index('categoryName'),k=this.listItems.findIndex(function(n){return n.categoryName===d}),l=h.delete(this.listItems[k].id),m=help.findIndex(function(n){return n.categoryName===d});help.splice(m,1),l.onsuccess=function(){console.log('---------------------------------------'),console.log('categoryName: '+d),console.log('key: '+k),console.log('delete')},this.updateRecords()},updateRecords:function(){console.log('---------------------------------------'),this.splice('listItems',0),this.listItems=[];var c=[],d=openCategory.result,f=d.transaction('MyObjectStore','readwrite'),g=f.objectStore('MyObjectStore'),h=g.index('categoryName');h.openCursor().onsuccess=function(j){if(cursor=j.target.result,cursor){var k={id:cursor.value.id,categoryName:cursor.value.categoryName,isComplete:cursor.value.isComplete};console.log('cursor: '+cursor.value.id+' '+cursor.value.categoryName+' '+cursor.value.isComplete),c.push(k),cursor.continue()}else console.log('-----test len: '+c.length)},help.sort(function(j,k){return j.id-k.id}),this.updateR(c)},updateR:function(){for(this.splice('listItems',0),i=0;i<help.length;i++){var d={id:help[i].id,categoryName:help[i].categoryName,isComplete:help[i].isComplete};this.push('listItems',d)}},clearList:function(){help.splice(0,help.length)}});var ind=0,cursor;window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB;var openCategory=window.indexedDB.open('MyData',1);openCategory.onupgradeneeded=function(){var c=openCategory.result,d=c.createObjectStore('MyObjectStore',{keyPath:'id'}),f=d.createIndex('categoryName','categoryName')};var help=[];openCategory.onsuccess=function(){var c=openCategory.result,d=c.transaction('MyObjectStore','readwrite'),f=d.objectStore('MyObjectStore'),g=f.index('categoryName');g.openCursor().onsuccess=function(h){if(cursor=h.target.result,cursor){var j={id:cursor.value.id,categoryName:cursor.value.categoryName,isComplete:cursor.value.isComplete};ind<cursor.value.id&&(ind=cursor.value.id),help.push(j),console.log('cursor: '+cursor.value.id+' '+cursor.value.categoryName+' '+cursor.value.isComplete),cursor.continue()}else console.log('ind: '+ind)}};</script></dom-module></body></html>