<html><head><link rel="import" href="../bower_components/polymer/polymer.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/paper-item/paper-item.html"><link rel="import" href="../bower_components/iron-list/iron-list.html"><link rel="import" href="../bower_components/iron-label/iron-label.html"><link rel="import" href="../bower_components/paper-card/paper-card.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/paper-styles/color.html"><link rel="import" href="../bower_components/paper-styles/typography.html"><link rel="import" href="../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="my-view1"><template><style>:host{display:block;line-height:8px;padding:10px;}body{display:flex;align-items:center;justify-content:center;}paper-card{max-width:500px;margin-bottom:15px;display:block;background:white;padding:10px;border-radius:20px;line-height:8px;}.cafe-header{@apply (--paper-font-headline);}.cafe-button{color:var(--google-blue-500);}.card{margin:24px;padding:16px;color:#757575;border-radius:5px;background-color:#fff;box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);}</style><paper-button raised="" noink="" id="updateCategoryBtn1" on-click="updateRecords">Обновить</paper-button><template is="dom-repeat" items="{{listItems}}"><paper-card><div class="cafe-header">{{ item.itemName }}</div><p>[[item.name]]</p><p class="cafe-light">Количество: {{ item.count }}</p><p class="cafe-light">Цена: {{ item.price }}</p><p class="cafe-light">Коментарий: {{ item.comm }}</p><p class="cafe-light">Категория: {{item.categoryName }}</p><div class="card-actions"><div class="horizontal justified"><paper-button raised="" noink="" on-click="showEditRecordDialog" class="cafe-button">Изменить</paper-button><paper-button raised="" noink="" on-click="deleteRecord" class="cafe-button">Удалить</paper-button></div></div></paper-card></template><paper-dialog id="editRecordDialog" style="overflow-y : scroll"><h4>Редактировать покупку</h4><paper-input label="Имя покупки" value="{{ editItemsName }}"></paper-input><paper-input label="Количество" type="number" min="0" value="{{ editCount }}"></paper-input><paper-input label="Цена" type="number" min="0" value="{{ editPrice }}"></paper-input><paper-input label="Комментарий" value="{{ editComm }}"></paper-input><div class="buttons"><paper-button dialog-dismiss="">Отмена</paper-button><paper-button on-click="editRecord">Сохранить</paper-button></div></paper-dialog></template><script>Polymer({is:'my-view1',properties:{prop1:{type:String,value:'my-view3'},categoryList:{type:Array,value:[]},merList:{type:Array,value:[{merName:'\u043A\u0433'},{merName:'\u043B\u0438\u0442\u0440\u044B'},{merName:'\u0448\u0442\u0443\u043A\u0438'}]},listItems:{type:Array,value:[]}},ready:function(){this.listItems=[],this.latestCategoryName=''},showEditRecordDialog:function(c){this.$.editRecordDialog.open(),this.editItemsName=c.model.item.itemName,this.editCount=c.model.item.count,this.editCategoryName=c.model.item.categoryName,this.editPrice=c.model.item.price,this.editComm=c.model.item.comm,this.latestItemName=c.model.item.itemName,this.latestCategoryName=c.model.item.categoryName,this.latestCount=c.model.item.count,this.latestPrice=c.model.item.price,this.latestComm=c.model.item.comm},editRecord:function(){var c=this.editItemsName,d=this.editCount,f=this.latestItemName,g=this.latestCategoryName,h=helpS.findIndex(function(r){return r.itemName===f}),j=this.editPrice,k=this.editComm,l=open.result,m=l.transaction('MyObjectStore','readwrite'),n=m.objectStore('MyObjectStore'),p=n.index('itemName'),q=p.get(f);q.onsuccess=function(){console.log('---------------------------------------'),console.log('edit: \''+f+'\' to \''+c+'\'');var s=q.result;s.itemName=c,s.count=d,s.price=j,s.comm=k;var t=n.put(s);t.onsuccess=function(){console.log('edit')}},helpS[h].itemName=c,helpS[h].count=d,helpS[h].price=j,helpS[h].comm=k,this.$.editRecordDialog.close(),this.updateRecords(),console.log('edit')},deleteRecord:function(c){var d=c.model.item.itemName,f=open.result,g=f.transaction('MyObjectStore','readwrite'),h=g.objectStore('MyObjectStore'),j=h.index('itemName'),k=c.model.item.id,l=h.delete(k),m=helpS.findIndex(function(n){return n.itemName===d});helpS.splice(m,1),l.onsuccess=function(){console.log('---------------------------------------'),console.log('itemName: '+d),console.log('key: '+k),console.log('delete')},this.updateRecords()},updateRecords:function(){console.log('---------------------------------------'),this.splice('listItems',0),this.listItems=[];var c=open.result,d=c.transaction('MyObjectStore','readwrite'),f=d.objectStore('MyObjectStore'),g=f.index('itemName');g.openCursor().onsuccess=function(h){if(cursor=h.target.result,cursor){({id:cursor.value.id,itemName:cursor.value.itemName,isComplete:cursor.value.isComplete,categoryID:cursor.value.categoryID,count:cursor.value.count,mer:cursor.value.mer,price:cursor.value.price,comm:cursor.value.comm});console.log('cursor: '+cursor.value.id+' '+cursor.value.itemName+' '+cursor.value.categoryName+' '+cursor.value.categoryID+' '+cursor.value.isComplete+' '+cursor.value.count+' '+cursor.value.mer+' '+cursor.value.price+' '+cursor.value.comm),cursor.continue()}else;},helpS.sort(function(h,j){return h.id-j.id}),this.updateR()},updateR:function(){for(this.splice('listItems',0),i=0;i<helpS.length;i++){var c={id:helpS[i].id,itemName:helpS[i].itemName,categoryName:helpS[i].categoryName,categoryID:helpS[i].categoryID,isComplete:helpS[i].isComplete,count:helpS[i].count,mer:helpS[i].mer,price:helpS[i].price,comm:helpS[i].comm};this.push('listItems',c),console.log('helpS: '+helpS[i].count+' '+helpS[i].mer)}},clearList:function(){help.splice(0,help.length)}});var ind=0,cursor;window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB;var open=indexedDB.open('MyData2',1);open.onupgradeneeded=function(){var c=open.result,d=c.createObjectStore('MyObjectStore',{keyPath:'id'}),f=d.createIndex('itemName','itemName')},open.onsuccess=function(){var c=open.result,d=c.transaction('MyObjectStore','readwrite'),f=d.objectStore('MyObjectStore'),g=f.index('itemName');g.openCursor().onsuccess=function(h){if(cursor=h.target.result,cursor){var j={id:cursor.value.id,itemName:cursor.value.itemName,categoryName:cursor.value.categoryName,categoryID:cursor.value.categoryID,isComplete:cursor.value.isComplete,count:cursor.value.count,price:cursor.value.price,comm:cursor.value.comm};ind<cursor.value.id&&(ind=cursor.value.id),helpS.push(j),console.log('cursor:  '+cursor.value.itemName+'  '+cursor.value.categoryName+' '+cursor.value.categoryID+' '+cursor.value.count+' '+cursor.value.price+' '+cursor.value.comm),cursor.continue()}else console.log('ind: '+ind)}};var helpS=[];</script></dom-module></body></html>